<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK-Mixer: Cryptographic Flow Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 20px;
        }
        
        h1 {
            color: #00ff88;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .subtitle {
            color: #888;
            font-size: 0.9em;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid #444;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }
        
        .tab-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #1e1e2e;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .phase {
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid #00ff88;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .phase h2 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .step {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            margin: 10px 0;
            border-radius: 3px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .step-number {
            display: inline-block;
            background: #00ff88;
            color: #1e1e2e;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .step-title {
            color: #00ff88;
            font-weight: bold;
            display: inline;
        }
        
        .step-desc {
            margin-top: 10px;
            color: #aaa;
            font-size: 0.9em;
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
            border-radius: 3px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.85em;
            overflow-x: auto;
            color: #00ff88;
        }
        
        .flow-diagram {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #00ff88;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .flow-item {
            display: inline-block;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 3px;
            text-align: center;
        }
        
        .arrow {
            display: inline-block;
            margin: 0 10px;
            color: #00ff88;
        }
        
        .proof-component {
            background: rgba(50, 50, 80, 0.5);
            border-left: 3px solid #4488ff;
            padding: 10px;
            margin: 8px 0;
            font-size: 0.9em;
        }
        
        .proof-component.public {
            border-left-color: #ff4488;
        }
        
        .proof-component.private {
            border-left-color: #44ff88;
        }
        
        .proof-component.derived {
            border-left-color: #ffaa44;
        }
        
        .proof-label {
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }
        
        .crypto-table {
            width: 100%;
            margin: 15px 0;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #444;
        }
        
        .crypto-table th {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #00ff88;
        }
        
        .crypto-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #333;
        }
        
        .crypto-table tr:hover {
            background: rgba(0, 255, 136, 0.05);
        }
        
        .security-check {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 0.9em;
        }
        
        .check-mark {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #00ff88;
            color: #1e1e2e;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .interactive-demo {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #00ff88;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .demo-input {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        
        .demo-button {
            padding: 10px 20px;
            background: #00ff88;
            color: #1e1e2e;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }
        
        .demo-button:hover {
            background: #00dd77;
            transform: scale(1.05);
        }
        
        .demo-output {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #444;
            border-radius: 3px;
            padding: 12px;
            margin-top: 10px;
            min-height: 60px;
            color: #00ff88;
            font-size: 0.85em;
            word-break: break-all;
        }
        
        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-box {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #00ff88;
            border-radius: 4px;
            padding: 15px;
        }
        
        .comparison-title {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .comparison-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            font-size: 0.9em;
        }
        
        .comparison-item:last-child {
            border-bottom: none;
        }
        
        .formula {
            background: rgba(0, 0, 0, 0.5);
            border-left: 3px solid #ffaa44;
            padding: 12px;
            margin: 10px 0;
            font-style: italic;
            color: #ffaa44;
        }
        
        .footer {
            text-align: center;
            padding-top: 40px;
            border-top: 1px solid #444;
            color: #666;
            font-size: 0.85em;
        }
        
        .research-badge {
            display: inline-block;
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid #4488ff;
            padding: 8px 12px;
            border-radius: 3px;
            font-size: 0.8em;
            color: #4488ff;
            margin: 5px;
        }
        
        @media (max-width: 768px) {
            .comparison-table {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê ZK-Mixer: Cryptographic Flow</h1>
            <p class="subtitle">Complete visualization of Zerocash + Morales et al. implementation</p>
            <div style="margin-top: 10px;">
                <span class="research-badge">Zerocash: Ben-Sasson et al. (2014)</span>
                <span class="research-badge">Morales et al. (2021)</span>
            </div>
        </header>
        
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('zerocash')">Zerocash Flow</button>
            <button class="tab-btn" onclick="switchTab('morales')">Morales Extension</button>
            <button class="tab-btn" onclick="switchTab('crypto')">Crypto Primitives</button>
            <button class="tab-btn" onclick="switchTab('proofs')">zk-SNARK Proofs</button>
            <button class="tab-btn" onclick="switchTab('demo')">Interactive Demo</button>
        </div>
        
        <!-- ZEROCASH FLOW TAB -->
        <div id="zerocash" class="tab-content active">
            <div class="phase">
                <h2>Phase 1: DEPOSIT</h2>
                <p style="margin-bottom: 15px; color: #aaa;">User deposits funds and receives commitment proof</p>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <span class="step-title">Generate Coin</span>
                    <div class="step-desc">
                        User generates random values: k (spend key), r (randomness), v (value)
                        <div class="code-block">k = random(256 bits)<br>r = random(256 bits)<br>v = amount (satoshis)</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-title">Create Commitment</span>
                    <div class="step-desc">
                        Compute commitment: c = Hash_cm(k || r || v)
                        <div class="code-block">c = SHA256(k || r || v)<br>Result: 256-bit commitment hash</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-title">Add to Merkle Tree</span>
                    <div class="step-desc">
                        Commitment added to mixer's Merkle tree
                        <div class="code-block">leaf_index = tree.insert(c)<br>merkle_root = tree.root<br>merkle_path = tree.prove(leaf_index)</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">4</span>
                    <span class="step-title">Encrypt Identity</span>
                    <div class="step-desc">
                        User identity encrypted with auditor's public key
                        <div class="code-block">encrypted_identity = RSA_encrypt(auditor_pk, user_id)</div>
                    </div>
                </div>
            </div>
            
            <div class="phase">
                <h2>Phase 2: WITHDRAWAL</h2>
                <p style="margin-bottom: 15px; color: #aaa;">User withdraws funds using zk-SNARK proof</p>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <span class="step-title">Derive Nullifier</span>
                    <div class="step-desc">
                        Compute nullifier: sn = Hash_sn(k, rho)
                        <div class="code-block">sn = SHA256(k || rho)<br>Properties:<br>‚úì Unique per withdrawal<br>‚úì Cannot link to commitment<br>‚úì Prevents double-spending</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-title">Generate zk-SNARK Proof</span>
                    <div class="step-desc">
                        Create non-interactive zero-knowledge proof
                        <div class="code-block">Proves WITHOUT revealing k, r, v:<br>‚úì Commitment in tree (merkle_path)<br>‚úì Nullifier correct (k, rho)<br>‚úì Amount preserved (v_in = v_out)<br>‚úì Output well-formed</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-title">Submit Withdrawal</span>
                    <div class="step-desc">
                        Send proof + nullifier to mixer
                        <div class="code-block">POST /withdraw {<br>&nbsp;&nbsp;zk_proof: proof,<br>&nbsp;&nbsp;nullifier: sn,<br>&nbsp;&nbsp;merkle_path: path,<br>&nbsp;&nbsp;output_commitment: c_out<br>}</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">4</span>
                    <span class="step-title">Mixer Verification</span>
                    <div class="step-desc">
                        Mixer verifies proof and checks nullifier
                        <div class="code-block">‚úì Nullifier not in spent set?<br>‚úì zk-SNARK proof valid?<br>‚úì Merkle path correct?<br>‚úì All checks pass ‚Üí Accept</div>
                    </div>
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3 style="color: #00ff88; margin-bottom: 15px;">Complete Payment Flow</h3>
                <div>
                    <div class="flow-item">User<br>Coin</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-item">Commitment<br>Hash</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-item">Merkle<br>Tree</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-item">Merkle<br>Root</div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="flow-item">Spend Key<br>Randomness</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-item">Nullifier<br>Hash</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-item">zk-SNARK<br>Proof</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-item">Verification<br>Success</div>
                </div>
            </div>
        </div>
        
        <!-- MORALES EXTENSION TAB -->
        <div id="morales" class="tab-content">
            <div class="phase">
                <h2>Privacy Level Controls</h2>
                <p style="margin-bottom: 15px; color: #aaa;">User-controlled privacy with reversible unlinkability</p>
                
                <table class="crypto-table">
                    <thead>
                        <tr>
                            <th>Privacy Level</th>
                            <th>Description</th>
                            <th>Auditor Access</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>HIGH</strong></td>
                            <td>No relinkeability possible</td>
                            <td>Cannot relink</td>
                        </tr>
                        <tr>
                            <td><strong>MEDIUM</strong></td>
                            <td>Selective disclosure allowed</td>
                            <td>Limited fields only</td>
                        </tr>
                        <tr>
                            <td><strong>LOW</strong></td>
                            <td>Full relinkeability</td>
                            <td>Can see everything</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="phase">
                <h2>Trapdoor Function (RSA-based)</h2>
                <p style="margin-bottom: 15px; color: #aaa;">Conditional disclosure mechanism</p>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <span class="step-title">Create Trapdoor</span>
                    <div class="step-desc">
                        Generate RSA-2048 key pair for auditor
                        <div class="code-block">public_key = (N, e)<br>private_key = (N, d)<br>Only auditor has private_key!</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-title">Set Disclosure Policy</span>
                    <div class="step-desc">
                        User defines what can be revealed to whom
                        <div class="code-block">DisclosurePolicy {<br>&nbsp;&nbsp;privacy_level: MEDIUM,<br>&nbsp;&nbsp;allowed_auditors: [...],<br>&nbsp;&nbsp;disclosure_fields: [<br>&nbsp;&nbsp;&nbsp;&nbsp;"sender_identity",<br>&nbsp;&nbsp;&nbsp;&nbsp;"amount"<br>&nbsp;&nbsp;],<br>&nbsp;&nbsp;expiry: 2025-12-31<br>}</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-title">Audit Request</span>
                    <div class="step-desc">
                        Auditor requests transaction relink
                        <div class="code-block">POST /audit {<br>&nbsp;&nbsp;transaction_hash: "...",<br>&nbsp;&nbsp;reason: "AML check",<br>&nbsp;&nbsp;auditor_id: "auditor@org"<br>}</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">4</span>
                    <span class="step-title">Selective Disclosure</span>
                    <div class="step-desc">
                        Mixer reveals only approved fields
                        <div class="code-block">REVEALED:<br>‚úì sender_identity = "alice@..."<br>‚úì amount = 1000 USD<br><br>HIDDEN:<br>‚úó recipient_address<br>‚úó transaction_time</div>
                    </div>
                </div>
                
                <div class="step">
                    <span class="step-number">5</span>
                    <span class="step-title">Audit Trail</span>
                    <div class="step-desc">
                        All disclosures logged immutably
                        <div class="code-block">AuditRecord {<br>&nbsp;&nbsp;auditor_id: "auditor@org",<br>&nbsp;&nbsp;timestamp: "2024-01-26T14:32:00Z",<br>&nbsp;&nbsp;reason: "AML check",<br>&nbsp;&nbsp;revealed_fields: [...],<br>&nbsp;&nbsp;status: "APPROVED"<br>}</div>
                    </div>
                </div>
            </div>
            
            <div class="phase">
                <h2>Security Properties</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3 style="color: #44ff88; margin-bottom: 10px;">User Privacy</h3>
                        <div class="security-check">
                            <span class="check-mark">‚úì</span>
                            <span>Conditional unlinkability</span>
                        </div>
                        <div class="security-check">
                            <span class="check-mark">‚úì</span>
                            <span>User consent required</span>
                        </div>
                        <div class="security-check">
                            <span class="check-mark">‚úì</span>
                            <span>Privacy by default</span>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="color: #ff4488; margin-bottom: 10px;">Auditor Accountability</h3>
                        <div class="security-check">
                            <span class="check-mark">‚úì</span>
                            <span>All audits logged</span>
                        </div>
                        <div class="security-check">
                            <span class="check-mark">‚úì</span>
                            <span>Cannot audit without policy</span>
                        </div>
                        <div class="security-check">
                            <span class="check-mark">‚úì</span>
                            <span>Audit proof immutable</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CRYPTO PRIMITIVES TAB -->
        <div id="crypto" class="tab-content">
            <div class="phase">
                <h2>Hash Functions</h2>
                
                <div class="proof-component public">
                    <div class="proof-label">Hash_cm (Commitment Hash)</div>
                    <div>c = SHA256(k || r || v)</div>
                    <div style="margin-top: 5px; font-size: 0.85em; color: #aaa;">
                        Binds spend key, randomness, and value into commitment
                    </div>
                </div>
                
                <div class="proof-component public">
                    <div class="proof-label">Hash_sn (Nullifier Hash)</div>
                    <div>sn = SHA256(k || rho)</div>
                    <div style="margin-top: 5px; font-size: 0.85em; color: #aaa;">
                        Derives unlinkable nullifier from spend key and serial number
                    </div>
                </div>
                
                <div class="proof-component public">
                    <div class="proof-label">Hash_merkle (Tree Hash)</div>
                    <div>parent = SHA256(left || right)</div>
                    <div style="margin-top: 5px; font-size: 0.85em; color: #aaa;">
                        Builds Merkle tree structure (O(log n) operations)
                    </div>
                </div>
            </div>
            
            <div class="phase">
                <h2>Elliptic Curve Operations (zk-SNARK)</h2>
                
                <table class="crypto-table">
                    <thead>
                        <tr>
                            <th>Operation</th>
                            <th>Formula</th>
                            <th>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Random Commitment</td>
                            <td>R = g^r</td>
                            <td>Witness commitment</td>
                        </tr>
                        <tr>
                            <td>Challenge</td>
                            <td>c = H(R || M)</td>
                            <td>Fiat-Shamir transform</td>
                        </tr>
                        <tr>
                            <td>Response</td>
                            <td>z = r + c¬∑k</td>
                            <td>Schnorr response</td>
                        </tr>
                        <tr>
                            <td>Verification</td>
                            <td>g^z = R ¬∑ A^c</td>
                            <td>Proof validation</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="phase">
                <h2>RSA Operations (Trapdoor)</h2>
                
                <div class="proof-component derived">
                    <div class="proof-label">Key Generation</div>
                    <div>RSA-2048: (N, e, d)</div>
                    <div style="margin-top: 5px; font-size: 0.85em; color: #aaa;">
                        Generate 2048-bit RSA key pair for trapdoor
                    </div>
                </div>
                
                <div class="proof-component derived">
                    <div class="proof-label">Encryption</div>
                    <div>c = m^e mod N</div>
                    <div style="margin-top: 5px; font-size: 0.85em; color: #aaa;">
                        Encrypt identity with auditor's public key
                    </div>
                </div>
                
                <div class="proof-component derived">
                    <div class="proof-label">Decryption</div>
                    <div>m = c^d mod N</div>
                    <div style="margin-top: 5px; font-size: 0.85em; color: #aaa;">
                        Only auditor can decrypt with private key d
                    </div>
                </div>
            </div>
            
            <div class="phase">
                <h2>Merkle Tree Structure</h2>
                
                <div class="formula">
                    Height: 32 levels (supports 2^32 ‚âà 4 billion coins)
                </div>
                
                <div class="formula">
                    Proof size: O(log n) = 32 hashes ‚âà 1 KB per coin
                </div>
                
                <div class="formula">
                    Verification: O(log n) = 32 hash operations
                </div>
                
                <pre style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 3px; overflow-x: auto;">
           Root (public)
          /    \
        /        \
      H          H
     / \        / \
    H   H      H   H
   /|   |      |   |\
  c‚ÇÄ c‚ÇÅ c‚ÇÇ c‚ÇÉ c‚ÇÑ c‚ÇÖ c‚ÇÜ c‚Çá
  
merkle_path = [sibling‚ÇÄ, sibling‚ÇÅ, sibling‚ÇÇ]
To verify: Hash tree from leaf up to root
                </pre>
            </div>
        </div>
        
        <!-- ZK-SNARK PROOFS TAB -->
        <div id="proofs" class="tab-content">
            <div class="phase">
                <h2>zk-SNARK Proof Structure (Bulletproofs)</h2>
                
                <div class="step">
                    <h3 style="color: #00ff88; margin-bottom: 15px;">Public Statement</h3>
                    <div class="proof-component public">
                        <div class="proof-label">merkle_root</div>
                        <div style="font-size: 0.9em;">Current root of commitment tree</div>
                    </div>
                    <div class="proof-component public">
                        <div class="proof-label">nullifier</div>
                        <div style="font-size: 0.9em;">Hash_sn(k, rho) - prevents double-spend</div>
                    </div>
                    <div class="proof-component public">
                        <div class="proof-label">output_commitment</div>
                        <div style="font-size: 0.9em;">Hash_cm(k_out, r_out, v_out)</div>
                    </div>
                </div>
                
                <div class="step">
                    <h3 style="color: #44ff88; margin-bottom: 15px;">Private Witness</h3>
                    <div class="proof-component private">
                        <div class="proof-label">spend_key (k)</div>
                        <div style="font-size: 0.9em;">256-bit secret key - MUST BE HIDDEN</div>
                    </div>
                    <div class="proof-component private">
                        <div class="proof-label">randomness (r)</div>
                        <div style="font-size: 0.9em;">256-bit blinding factor</div>
                    </div>
                    <div class="proof-component private">
                        <div class="proof-label">value (v)</div>
                        <div style="font-size: 0.9em;">64-bit amount (no inflation)</div>
                    </div>
                    <div class="proof-component private">
                        <div class="proof-label">merkle_path</div>
                        <div style="font-size: 0.9em;">Sibling hashes proving coin in tree</div>
                    </div>
                </div>
                
                <div class="step">
                    <h3 style="color: #ffaa44; margin-bottom: 15px;">Proof Components</h3>
                    <div class="proof-component derived">
                        <div class="proof-label">commitment_proof</div>
                        <div style="font-size: 0.9em;">Proves commitment in tree at position leaf_index</div>
                    </div>
                    <div class="proof-component derived">
                        <div class="proof-label">nullifier_proof</div>
                        <div style="font-size: 0.9em;">Proves nullifier = Hash_sn(k, rho)</div>
                    </div>
                    <div class="proof-component derived">
                        <div class="proof-label">value_proof</div>
                        <div style="font-size: 0.9em;">Proves v_in = v_out (amount preserved)</div>
                    </div>
                    <div class="proof-component derived">
                        <div class="proof-label">output_proof</div>
                        <div style="font-size: 0.9em;">Proves output commitment well-formed</div>
                    </div>
                </div>
            </div>
            
            <div class="phase">
                <h2>Verification Algorithm</h2>
                
                <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 3px; border-left: 3px solid #00ff88;">
                    <code style="color: #00ff88; line-height: 1.8;">
function verify_payment_proof(proof, merkle_root):<br>
&nbsp;&nbsp;// Check 1: Commitment is in tree<br>
&nbsp;&nbsp;if !merkle_verify(proof.commitment, merkle_root, proof.merkle_path):<br>
&nbsp;&nbsp;&nbsp;&nbsp;return FALSE<br>
<br>
&nbsp;&nbsp;// Check 2: Nullifier correct<br>
&nbsp;&nbsp;if !verify_nullifier_proof(proof.nullifier_proof):<br>
&nbsp;&nbsp;&nbsp;&nbsp;return FALSE<br>
<br>
&nbsp;&nbsp;// Check 3: Amount preserved<br>
&nbsp;&nbsp;if !verify_value_proof(proof.value_proof):<br>
&nbsp;&nbsp;&nbsp;&nbsp;return FALSE<br>
<br>
&nbsp;&nbsp;// Check 4: Output well-formed<br>
&nbsp;&nbsp;if !verify_output_proof(proof.output_proof):<br>
&nbsp;&nbsp;&nbsp;&nbsp;return FALSE<br>
<br>
&nbsp;&nbsp;return TRUE  // All checks passed
                    </code>
                </div>
            </div>
            
            <div class="phase">
                <h2>Security Properties Proven</h2>
                
                <div class="comparison-box">
                    <div class="comparison-title">Completeness</div>
                    <div style="font-size: 0.9em; color: #aaa;">
                        If user knows the coin (k, r, v) and it's in the tree,
                        the proof will always verify.
                    </div>
                </div>
                
                <div class="comparison-box">
                    <div class="comparison-title">Soundness</div>
                    <div style="font-size: 0.9em; color: #aaa;">
                        A forged proof (without knowing the coin) has negligible
                        probability of verifying (‚âà 1/2^128).
                    </div>
                </div>
                
                <div class="comparison-box">
                    <div class="comparison-title">Zero-Knowledge</div>
                    <div style="font-size: 0.9em; color: #aaa;">
                        Verifier learns ONLY that the coin is valid. Nothing about
                        k, r, v, merkle_path is revealed. Proof is unlinkable to
                        original deposit.
                    </div>
                </div>
                
                <div class="comparison-box">
                    <div class="comparison-title">Non-Malleability</div>
                    <div style="font-size: 0.9em; color: #aaa;">
                        Proof cannot be modified. Any bit flip invalidates the
                        entire proof (due to hash binding).
                    </div>
                </div>
            </div>
        </div>
        
        <!-- INTERACTIVE DEMO TAB -->
        <div id="demo" class="tab-content">
            <div class="interactive-demo">
                <h2 style="color: #00ff88; margin-bottom: 20px;">Interactive: Commit Generation</h2>
                
                <div>
                    <label style="color: #00ff88;">Spend Key (k):</label>
                    <input type="text" id="spendKey" class="demo-input" placeholder="Enter 64 hex characters or leave empty for random" maxlength="64">
                    
                    <label style="color: #00ff88; display: block; margin-top: 10px;">Randomness (r):</label>
                    <input type="text" id="randomness" class="demo-input" placeholder="Enter 64 hex characters or leave empty for random" maxlength="64">
                    
                    <label style="color: #00ff88; display: block; margin-top: 10px;">Value (v):</label>
                    <input type="number" id="value" class="demo-input" placeholder="Enter amount in satoshis" value="1000" min="0" max="18446744073709551615">
                    
                    <button class="demo-button" onclick="generateCommitment()">Generate Commitment</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="color: #00ff88;">Output:</label>
                    <div class="demo-output" id="commitOutput">
                        Commitment will appear here...
                    </div>
                </div>
            </div>
            
            <div class="interactive-demo">
                <h2 style="color: #00ff88; margin-bottom: 20px;">Interactive: Nullifier Derivation</h2>
                
                <div>
                    <label style="color: #00ff88;">Spend Key (k):</label>
                    <input type="text" id="nullifierKey" class="demo-input" placeholder="Enter spend key (64 hex chars)" maxlength="64">
                    
                    <label style="color: #00ff88; display: block; margin-top: 10px;">Serial Number (rho):</label>
                    <input type="text" id="serialNumber" class="demo-input" placeholder="Enter serial number (64 hex chars)" maxlength="64">
                    
                    <button class="demo-button" onclick="generateNullifier()">Generate Nullifier</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="color: #00ff88;">Output:</label>
                    <div class="demo-output" id="nullifierOutput">
                        Nullifier will appear here...
                    </div>
                </div>
            </div>
            
            <div class="interactive-demo">
                <h2 style="color: #00ff88; margin-bottom: 20px;">Merkle Tree Simulation</h2>
                
                <div>
                    <button class="demo-button" onclick="addCommitmentToTree()">Add Random Commitment</button>
                    <button class="demo-button" onclick="generateMerkleProof()">Generate Proof for Last Leaf</button>
                    <button class="demo-button" onclick="resetTree()">Reset Tree</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="color: #00ff88;">Tree State:</label>
                    <div class="demo-output" id="treeOutput" style="min-height: 150px;">
                        Tree is empty. Add commitments to begin...
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>ZK-Mixer: Zerocash + Morales et al. Implementation</p>
        <p style="margin-top: 10px; font-size: 0.8em;">
            Academic references: Ben-Sasson et al. (2014), Morales-Sandoval et al. (2021)
        </p>
    </div>
    
    <script>
        // State
        let merkleTree = [];
        let merkleRoots = [];
        
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active from all buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Highlight button
            event.target.classList.add('active');
        }
        
        // SHA-256 simulation (simplified)
        function simpleSHA256(input) {
            let hash = 0;
            for (let i = 0; i < input.length; i++) {
                const char = input.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32-bit integer
            }
            return Math.abs(hash).toString(16).padStart(64, '0').substring(0, 64);
        }
        
        function randomHex(bytes) {
            let result = '';
            for (let i = 0; i < bytes * 2; i++) {
                result += Math.floor(Math.random() * 16).toString(16);
            }
            return result;
        }
        
        function generateCommitment() {
            let k = document.getElementById('spendKey').value || randomHex(32);
            let r = document.getElementById('randomness').value || randomHex(32);
            let v = document.getElementById('value').value;
            
            if (k.length < 64) k = randomHex(32);
            if (r.length < 64) r = randomHex(32);
            
            const cm = simpleSHA256(k + r + v);
            
            document.getElementById('commitOutput').innerHTML = `
                <strong>Commitment Generated</strong><br><br>
                <strong>c = SHA256(k || r || v)</strong><br><br>
                k = ${k.substring(0, 32)}...${k.substring(32)}<br>
                r = ${r.substring(0, 32)}...${r.substring(32)}<br>
                v = ${v}<br><br>
                <strong>Commitment:</strong><br>
                ${cm.substring(0, 32)}<br>
                ${cm.substring(32)}<br><br>
                <small>‚úì This commitment will be added to the Merkle tree</small>
            `;
        }
        
        function generateNullifier() {
            let k = document.getElementById('nullifierKey').value;
            let rho = document.getElementById('serialNumber').value;
            
            if (!k || k.length < 64 || !rho || rho.length < 64) {
                document.getElementById('nullifierOutput').innerHTML = '<span style="color: #ff4488;">Error: Enter valid 64-character hex strings</span>';
                return;
            }
            
            const sn = simpleSHA256(k + rho);
            
            document.getElementById('nullifierOutput').innerHTML = `
                <strong>Nullifier Generated</strong><br><br>
                <strong>sn = SHA256(k || rho)</strong><br><br>
                k = ${k.substring(0, 32)}...${k.substring(32)}<br>
                rho = ${rho.substring(0, 32)}...${rho.substring(32)}<br><br>
                <strong>Nullifier (Spend Token):</strong><br>
                ${sn.substring(0, 32)}<br>
                ${sn.substring(32)}<br><br>
                <small>‚úì Cannot be linked to commitment</small><br>
                <small>‚úì Prevents double-spending</small>
            `;
        }
        
        function addCommitmentToTree() {
            const k = randomHex(32);
            const r = randomHex(32);
            const v = Math.floor(Math.random() * 1000);
            const cm = simpleSHA256(k + r + v);
            
            merkleTree.push(cm);
            updateTreeDisplay();
        }
        
        function generateMerkleProof() {
            if (merkleTree.length === 0) {
                document.getElementById('treeOutput').innerHTML = 'Add at least one commitment first';
                return;
            }
            
            const leafIndex = merkleTree.length - 1;
            const proof = merkleTree.map(c => c.substring(0, 8) + '...');
            
            document.getElementById('treeOutput').innerHTML = `
                <strong>Merkle Proof Generated</strong><br><br>
                <strong>Proving commitment at leaf index ${leafIndex}</strong><br><br>
                <strong>Proof path (${proof.length} hashes):</strong><br>
                ${proof.map((h, i) => `Level ${i}: ${h}`).join('<br>')}<br><br>
                <strong>Properties:</strong><br>
                ‚úì Proves coin is in tree<br>
                ‚úì Size: O(log n) = ${Math.ceil(Math.log2(merkleTree.length))} hashes<br>
                ‚úì Verifiable in O(log n) time<br>
                ‚úì Does not reveal other coins
            `;
        }
        
        function updateTreeDisplay() {
            const treeHtml = `
                <strong>Merkle Tree State</strong><br><br>
                <strong>Commitments in tree: ${merkleTree.length}</strong><br><br>
                <strong>Leaves:</strong><br>
                ${merkleTree.map((leaf, i) => 
                    `${i}: ${leaf.substring(0, 16)}...${leaf.substring(48)}<br>`
                ).join('')}<br>
                <strong>Tree height: ${Math.ceil(Math.log2(Math.max(merkleTree.length, 1)))}</strong><br>
                <button class="demo-button" style="margin-top: 10px;" onclick="generateMerkleProof()">Generate Proof</button>
            `;
            
            document.getElementById('treeOutput').innerHTML = treeHtml;
        }
        
        function resetTree() {
            merkleTree = [];
            merkleRoots = [];
            document.getElementById('treeOutput').innerHTML = 'Tree is empty. Add commitments to begin...';
        }
    </script>
</body>
</html>
